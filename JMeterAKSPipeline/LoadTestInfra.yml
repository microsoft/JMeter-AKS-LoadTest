pool:
  vmImage: "windows-latest"

trigger: none

steps:
  - task: AzureKeyVault@1
    displayName: Get Keyvault Secrets
    inputs:
      azureSubscription: $(ServiceConnection)
      KeyVaultName: $(KeyVaultName)
      SecretsFilter: $(SecretName)
      RunAsPreJob: true

  - task: PowerShell@2
    displayName: "Create AKS Cluster"
    inputs:
      targetType: filePath
      filePath: "./JMeterAKSPipeline/CreateLoadTestInfra.ps1"
      arguments: "-tenant $(Tenant) -defaultNamespace $(DefaultNamespace) -resourceGroup $(ResourceGroup) -aksClusterName $(AksClusterName) -spnClientId $(ServicePrincipalId) -spnClientSecret $(SecretName) -aksRegion $(AksRegion) -nodeVmSize $(NodeVmSize)"